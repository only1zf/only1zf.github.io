"use strict";(globalThis.webpackChunkpub=globalThis.webpackChunkpub||[]).push([[9016],{28453(n,s,e){e.d(s,{R:()=>c,x:()=>d});var r=e(96540);const l={},i=r.createContext(l);function c(n){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof n?n(s):{...s,...n}},[s,n])}function d(n){let s;return s=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:c(n.components),r.createElement(i.Provider,{value:s},n.children)}},62814(n,s,e){e.r(s),e.d(s,{assets:()=>o,contentTitle:()=>d,default:()=>x,frontMatter:()=>c,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"guides/aws-spot-tunnel","title":"AWS \u6781\u81f4\u4f4e\u6210\u672c\u53cc\u6808\u4ee3\u7406\u642d\u5efa\u624b\u518c (\u7eaf IPv6 \u7248)","description":"\u8fd9\u662f\u4e00\u4e2a\u5173\u4e8e\u5728 AWS \u4e0a\u5229\u7528 Spot \u5b9e\u4f8b\u642d\u5efa\u4f4e\u6210\u672c\u3001\u9ad8\u533f\u540d\u3001\u53cc\u6808\u4ee3\u7406\u670d\u52a1\u7684\u5b8c\u6574\u5b9e\u65bd\u624b\u518c\u3002\u672c\u65b9\u6848\u901a\u8fc7\u7eaf IPv6 \u7f51\u7edc\u67b6\u6784\u5f7b\u5e95\u514d\u9664\u4e86 IPv4 \u5730\u5740\u8d39\u7528\uff0c\u5e76\u5229\u7528 Cloudflare \u751f\u6001\u5b9e\u73b0\u4e86\u5168\u81ea\u52a8\u5316\u7684\u7f51\u7edc\u7a7f\u900f\u4e0e\u5206\u6d41\u3002","source":"@site/docs/guides/aws-spot-tunnel.md","sourceDirName":"guides","slug":"/guides/aws-spot-tunnel","permalink":"/docs/guides/aws-spot-tunnel","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"guidesSidebar"}');var l=e(74848),i=e(28453);const c={},d="AWS \u6781\u81f4\u4f4e\u6210\u672c\u53cc\u6808\u4ee3\u7406\u642d\u5efa\u624b\u518c (\u7eaf IPv6 \u7248)",o={},t=[{value:"1. \u65b9\u6848\u6982\u8ff0",id:"1-\u65b9\u6848\u6982\u8ff0",level:2},{value:"2. \u524d\u7f6e\u51c6\u5907",id:"2-\u524d\u7f6e\u51c6\u5907",level:2},{value:"3. AWS \u7f51\u7edc\u73af\u5883\u914d\u7f6e (\u5173\u952e)",id:"3-aws-\u7f51\u7edc\u73af\u5883\u914d\u7f6e-\u5173\u952e",level:2},{value:"4. \u521b\u5efa Spot \u5b9e\u4f8b\u4e0e\u90e8\u7f72",id:"4-\u521b\u5efa-spot-\u5b9e\u4f8b\u4e0e\u90e8\u7f72",level:2},{value:"5. Cloudflare \u540e\u53f0\u914d\u7f6e",id:"5-cloudflare-\u540e\u53f0\u914d\u7f6e",level:2},{value:"6. \u5ba2\u6237\u7aef\u8fde\u63a5\u914d\u7f6e",id:"6-\u5ba2\u6237\u7aef\u8fde\u63a5\u914d\u7f6e",level:2},{value:"7. \u6545\u969c\u6392\u67e5\u4e0e\u7ef4\u62a4",id:"7-\u6545\u969c\u6392\u67e5\u4e0e\u7ef4\u62a4",level:2},{value:"8. \u5b89\u5168\u5efa\u8bae",id:"8-\u5b89\u5168\u5efa\u8bae",level:2}];function h(n){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.header,{children:(0,l.jsx)(s.h1,{id:"aws-\u6781\u81f4\u4f4e\u6210\u672c\u53cc\u6808\u4ee3\u7406\u642d\u5efa\u624b\u518c-\u7eaf-ipv6-\u7248",children:"AWS \u6781\u81f4\u4f4e\u6210\u672c\u53cc\u6808\u4ee3\u7406\u642d\u5efa\u624b\u518c (\u7eaf IPv6 \u7248)"})}),"\n",(0,l.jsxs)(s.p,{children:["\u8fd9\u662f\u4e00\u4e2a\u5173\u4e8e\u5728 AWS \u4e0a\u5229\u7528 Spot \u5b9e\u4f8b\u642d\u5efa\u4f4e\u6210\u672c\u3001\u9ad8\u533f\u540d\u3001\u53cc\u6808\u4ee3\u7406\u670d\u52a1\u7684\u5b8c\u6574\u5b9e\u65bd\u624b\u518c\u3002\u672c\u65b9\u6848\u901a\u8fc7",(0,l.jsx)(s.strong,{children:"\u7eaf IPv6 \u7f51\u7edc\u67b6\u6784"}),"\u5f7b\u5e95\u514d\u9664\u4e86 IPv4 \u5730\u5740\u8d39\u7528\uff0c\u5e76\u5229\u7528 Cloudflare \u751f\u6001\u5b9e\u73b0\u4e86\u5168\u81ea\u52a8\u5316\u7684\u7f51\u7edc\u7a7f\u900f\u4e0e\u5206\u6d41\u3002"]}),"\n",(0,l.jsx)(s.h2,{id:"1-\u65b9\u6848\u6982\u8ff0",children:"1. \u65b9\u6848\u6982\u8ff0"}),"\n",(0,l.jsx)(s.p,{children:"\u672c\u65b9\u6848\u65e8\u5728\u6784\u5efa\u4e00\u4e2a\u65e0\u9700\u516c\u7f51 IPv4 \u5730\u5740\u3001\u65e0 NAT \u7f51\u5173\u8d39\u7528\u3001\u5177\u5907\u81ea\u52a8\u6545\u969c\u6062\u590d\u80fd\u529b\u7684\u4ee3\u7406\u670d\u52a1\u3002"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u6838\u5fc3\u67b6\u6784"}),"\uff1aAWS Spot Instance (t4g.micro) + Cloudflare Tunnel + Docker (Xray) + WARP\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u6210\u672c\u4f18\u52bf"}),"\uff1a\u5229\u7528 Spot \u7ade\u4ef7\u5b9e\u4f8b\u548c\u7eaf IPv6 \u7f51\u7edc\uff0c\u8d39\u7528\u4f4e\u5ec9\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u7f51\u7edc\u903b\u8f91"}),"\uff1a","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u5165\u7ad9"}),"\uff1a\u901a\u8fc7 Cloudflare Tunnel (IPv6) \u7a7f\u900f\u5185\u7f51\uff0c\u65e0\u9700\u516c\u7f51 IP\uff0c\u65e0\u9700\u5f00\u653e\u5b89\u5168\u7ec4\u5165\u7ad9\u7aef\u53e3\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u51fa\u7ad9 (IPv6)"}),"\uff1a\u901a\u8fc7 AWS Egress-only Internet Gateway \u76f4\u8fde\uff0c\u4f4e\u5ef6\u8fdf\u8bbf\u95ee Google/Netflix\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u51fa\u7ad9 (IPv4)"}),"\uff1a\u901a\u8fc7 Cloudflare WARP \u4ee3\u7406\u6a21\u5f0f\u8f6c\u53d1\uff0c\u89e3\u51b3 GitHub/Twitter \u7b49\u7eaf IPv4 \u7ad9\u70b9\u7684\u8bbf\u95ee\u95ee\u9898\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"2-\u524d\u7f6e\u51c6\u5907",children:"2. \u524d\u7f6e\u51c6\u5907"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"AWS \u8d26\u6237"}),"\uff1a\u5df2\u5f00\u901a EC2 Spot \u5b9e\u4f8b\u4f7f\u7528\u6743\u9650\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Cloudflare \u8d26\u6237"}),"\uff1a\u62e5\u6709\u4e00\u4e2a\u6258\u7ba1\u5728 Cloudflare \u4e0a\u7684\u57df\u540d\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u83b7\u53d6 Tunnel Token"}),"\uff1a","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\u767b\u5f55 ",(0,l.jsx)(s.a,{href:"https://one.dash.cloudflare.com/",children:"Cloudflare Zero Trust"})," > ",(0,l.jsx)(s.strong,{children:"Networks"})," > ",(0,l.jsx)(s.strong,{children:"Tunnels"}),"\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:["\u70b9\u51fb ",(0,l.jsx)(s.strong,{children:"Create a tunnel"}),"\uff0c\u9009\u62e9 ",(0,l.jsx)(s.strong,{children:"Cloudflared"}),"\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:["\u547d\u540d\u96a7\u9053\uff08\u5982 ",(0,l.jsx)(s.code,{children:"aws-proxy"}),"\uff09\uff0c\u5728\u5b89\u88c5\u9875\u9762\u590d\u5236 Token\uff08\u4ee5 ",(0,l.jsx)(s.code,{children:"ey"})," \u5f00\u5934\u7684\u957f\u5b57\u7b26\u4e32\uff09\uff0c\u4fdd\u5b58\u5907\u7528\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"3-aws-\u7f51\u7edc\u73af\u5883\u914d\u7f6e-\u5173\u952e",children:"3. AWS \u7f51\u7edc\u73af\u5883\u914d\u7f6e (\u5173\u952e)"}),"\n",(0,l.jsxs)(s.p,{children:["\u4e3a\u4e86\u5b9e\u73b0\u201c\u96f6 IPv4 \u8d39\u7528\u201d\u4e14\u80fd\u8054\u7f51\uff0c\u5fc5\u987b\u4e25\u683c\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u521b\u5efa VPC\u3002\u6b64\u6b65\u9aa4\u57fa\u4e8e ",(0,l.jsx)(s.strong,{children:'"Create VPC and more"'})," \u5411\u5bfc\u914d\u7f6e\u3002"]}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["\u767b\u5f55 AWS \u63a7\u5236\u53f0\uff0c\u8fdb\u5165 ",(0,l.jsx)(s.strong,{children:"VPC"})," \u670d\u52a1\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:["\u70b9\u51fb ",(0,l.jsx)(s.strong,{children:"Create VPC"}),"\uff0c\u9009\u62e9 ",(0,l.jsx)(s.strong,{children:"VPC and more"}),"\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u914d\u7f6e\u53c2\u6570\u5982\u4e0b\uff08\u4e25\u7981\u9009\u9519\uff09"}),"\uff1a","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"IPv4 CIDR block"}),": ",(0,l.jsx)(s.code,{children:"10.0.0.0/16"})," (\u4fdd\u7559\u9ed8\u8ba4\uff0c\u5185\u7f51\u7528\uff0c\u4e0d\u6536\u8d39)\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"IPv6 CIDR block"}),": \u9009\u62e9 ",(0,l.jsx)(s.strong,{children:"Amazon-provided IPv6 CIDR block"})," (\u5fc5\u987b\u9009\u6b64\u9879\uff0c\u5426\u5219\u673a\u5668\u65e0\u6cd5\u4e0a\u7f51)\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Tenancy"}),": Default\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Number of Availability Zones (AZs)"}),": ",(0,l.jsx)(s.code,{children:"1"})," (\u5355\u53ef\u7528\u533a\u5373\u53ef)\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Number of public subnets"}),": ",(0,l.jsx)(s.strong,{children:(0,l.jsx)(s.code,{children:"0"})})," (\u5173\u952e\uff1a\u8bbe\u4e3a 0 \u4ee5\u675c\u7edd IPv4 \u516c\u7f51\u7f51\u5173\u521b\u5efa)\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Number of private subnets"}),": ",(0,l.jsx)(s.code,{children:"1"}),"\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"NAT gateways"}),": ",(0,l.jsx)(s.strong,{children:(0,l.jsx)(s.code,{children:"None"})})," (\u5173\u952e\uff1aNAT \u7f51\u5173\u975e\u5e38\u6602\u8d35\uff0c\u5fc5\u987b\u9009\u65e0)\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"VPC endpoints"}),": ",(0,l.jsx)(s.code,{children:"S3 Gateway"})," (\u53ef\u9009\uff0c\u63a8\u8350\u4fdd\u7559\uff0c\u514d\u8d39)\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Egress only internet gateway"}),": ",(0,l.jsx)(s.strong,{children:(0,l.jsx)(s.code,{children:"Yes"})})," (\u6838\u5fc3\u7ec4\u4ef6\uff1a\u5141\u8bb8 IPv6 \u5355\u5411\u51fa\u7ad9\u8bbf\u95ee\u4e92\u8054\u7f51\uff0c\u514d\u8d39)\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\u70b9\u51fb ",(0,l.jsx)(s.strong,{children:"Create VPC"})," \u7b49\u5f85\u8d44\u6e90\u521b\u5efa\u5b8c\u6210\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u4fee\u6539\u5b50\u7f51\u8bbe\u7f6e"}),"\uff1a","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\u8fdb\u5165 ",(0,l.jsx)(s.strong,{children:"Subnets"}),"\uff0c\u9009\u4e2d\u521a\u624d\u521b\u5efa\u7684 Private Subnet\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:["\u70b9\u51fb ",(0,l.jsx)(s.strong,{children:"Actions"})," > ",(0,l.jsx)(s.strong,{children:"Edit subnet settings"}),"\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u52fe\u9009"})," ",(0,l.jsx)(s.code,{children:"Enable auto-assign IPv6 address"}),"\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u786e\u4fdd\u672a\u52fe\u9009"})," ",(0,l.jsx)(s.code,{children:"Enable auto-assign public IPv4 address"}),"\u3002"]}),"\n",(0,l.jsx)(s.li,{children:"\u70b9\u51fb\u4fdd\u5b58\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"4-\u521b\u5efa-spot-\u5b9e\u4f8b\u4e0e\u90e8\u7f72",children:"4. \u521b\u5efa Spot \u5b9e\u4f8b\u4e0e\u90e8\u7f72"}),"\n",(0,l.jsxs)(s.p,{children:["\u6211\u4eec\u5c06\u4f7f\u7528 ",(0,l.jsx)(s.strong,{children:"User Data"})," \u811a\u672c\u5728\u5b9e\u4f8b\u542f\u52a8\u65f6\u81ea\u52a8\u5b8c\u6210\u6240\u6709\u8f6f\u4ef6\uff08Docker, Xray, WARP, Cloudflared\uff09\u7684\u5b89\u88c5\u4e0e\u914d\u7f6e\u3002"]}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["\u8fdb\u5165 ",(0,l.jsx)(s.strong,{children:"EC2 \u63a7\u5236\u53f0"})," > ",(0,l.jsx)(s.strong,{children:"Spot Requests"})," > ",(0,l.jsx)(s.strong,{children:"Request Spot Instances"}),"\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u542f\u52a8\u6a21\u677f\u8bbe\u7f6e"}),"\uff1a","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"AMI"}),": \u9009\u62e9 ",(0,l.jsx)(s.strong,{children:"Ubuntu Server 24.04 LTS (64-bit Arm)"}),"\u3002","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.em,{children:"\u6ce8\u610f\uff1a\u5fc5\u987b\u9009 ARM \u67b6\u6784\u4ee5\u5339\u914d t4g \u673a\u578b\u3002"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Instance type"}),": \u9009\u62e9 ",(0,l.jsx)(s.code,{children:"t4g.micro"}),"\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Key pair"}),": \u9009\u62e9\u4f60\u7684 SSH \u5bc6\u94a5\u5bf9\uff08\u867d\u7136\u6211\u4eec\u4e3b\u8981\u901a\u8fc7 SSM \u6216\u4e32\u53e3\u8c03\u8bd5\uff0c\u4f46\u5efa\u8bae\u7ed1\u5b9a\uff09\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Network settings"}),":","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"VPC"}),": \u9009\u62e9\u7b2c 3 \u6b65\u521b\u5efa\u7684 VPC\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Subnet"}),": \u9009\u62e9\u7b2c 3 \u6b65\u914d\u7f6e\u7684\u5b50\u7f51\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Auto-assign public IP"}),": ",(0,l.jsx)(s.strong,{children:"Disable"})," (\u7981\u7528)\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u9ad8\u7ea7\u8be6\u60c5 (Advanced details)"}),"\uff1a","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\u627e\u5230 ",(0,l.jsx)(s.strong,{children:"User data"})," \u6587\u672c\u6846\uff0c\u590d\u5236\u5e76\u7c98\u8d34\u4ee5\u4e0b\u811a\u672c\u3002"]}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.strong,{children:"\u26a0\ufe0f \u52a1\u5fc5\u4fee\u6539\u811a\u672c\u5f00\u5934\u7684 4 \u4e2a\u53d8\u91cf\u3002"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:'#!/bin/bash\n# ==========================================================\n# AWS Spot (Ubuntu 24.04 ARM64) \u7ec8\u6781\u53cc\u6808\u4ee3\u7406\u65b9\u6848\n# \u67b6\u6784\uff1a\u539f\u751f Cloudflare \u5de5\u5177 + Docker (Xray) + WARP Proxy\n# ==========================================================\n\n# --- [\u7528\u6237\u914d\u7f6e\u533a - \u8bf7\u4fee\u6539\u4ee5\u4e0b\u5185\u5bb9] ---\nCF_TOKEN="\u4f60\u7684_CLOUDFLARE_TUNNEL_TOKEN"\nXRAY_PWD="\u8bbe\u7f6e_XRAY_\u8fde\u63a5\u5bc6\u7801"\nWS_PATH="/\u4f60\u7684\u79d8\u5bc6\u8def\u5f84"  # \u4f8b\u5982 /trojan-ws\nROOT_PASSWORD="\u8bbe\u7f6e_ROOT_\u767b\u5f55\u5bc6\u7801" # \u7528\u4e8e AWS \u4e32\u53e3\u63a7\u5236\u53f0\u8c03\u8bd5\n# ----------------------------------\n\n# 1. \u8bbe\u7f6e\u7cfb\u7edf\u5bc6\u7801 (\u5f00\u542f Root \u548c Ubuntu \u7528\u6237\u4e32\u53e3\u767b\u5f55\u6743\u9650)\necho "root:${ROOT_PASSWORD}" | chpasswd\necho "ubuntu:${ROOT_PASSWORD}" | chpasswd\n\n# 2. \u57fa\u7840\u73af\u5883\u5b89\u88c5\nexport DEBIAN_FRONTEND=noninteractive\napt-get update -y\napt-get install curl ca-certificates gnupg lsb-release docker.io -y\nsystemctl start docker\nsystemctl enable docker\n\n# 3. \u6dfb\u52a0 Cloudflare \u5b98\u65b9\u6e90 (\u4fee\u590d GPG \u7b7e\u540d\u95ee\u9898)\nmkdir -p --mode=0755 /usr/share/keyrings\n\n# Cloudflared (Tunnel) \u6e90\ncurl -fsSL https://pkg.cloudflare.com/cloudflare-main.gpg | gpg --dearmor -o /usr/share/keyrings/cloudflare-main.gpg\necho "deb [signed-by=/usr/share/keyrings/cloudflare-main.gpg] https://pkg.cloudflare.com/cloudflared $(lsb_release -cs) main" | tee /etc/apt/sources.list.d/cloudflared.list\n\n# Cloudflare Client (WARP) \u6e90\ncurl -fsSL https://pkg.cloudflareclient.com/pubkey.gpg | gpg --dearmor -o /usr/share/keyrings/cloudflare-warp-archive-keyring.gpg\necho "deb [signed-by=/usr/share/keyrings/cloudflare-warp-archive-keyring.gpg] https://pkg.cloudflareclient.com/ $(lsb_release -cs) main" | tee /etc/apt/sources.list.d/cloudflare-client.list\n\n# 4. \u5b89\u88c5\u8f6f\u4ef6\napt-get update -y\napt-get install cloudflared cloudflare-warp -y\n\n# 5. \u914d\u7f6e WARP (\u4ee3\u7406\u6a21\u5f0f\uff0c\u76d1\u542c 127.0.0.1:40000)\n# \u4f5c\u7528\uff1a\u63d0\u4f9b IPv4 \u51fa\u7ad9\u80fd\u529b\uff0c\u4e14\u4e0d\u5e72\u6270\u539f\u751f IPv6 \u8def\u7531\nsystemctl enable --now warp-svc\nsleep 5\nwarp-cli --accept-tos registration new\nwarp-cli --accept-tos mode proxy\nwarp-cli --accept-tos connect\n\n# 6. \u914d\u7f6e Xray (Docker \u8fd0\u884c\uff0cHost \u6a21\u5f0f)\n# \u4f5c\u7528\uff1aTrojan \u534f\u8bae\u89e3\u5305\u3001\u5206\u6d41 (IPv6 \u76f4\u8fde / IPv4 \u8d70 WARP)\nmkdir -p /etc/xray\ncat > /etc/xray/config.json <<EOF\n{\n  "log": { "loglevel": "warning" },\n  "dns": { "servers": [ "2001:4860:4860::8888", "2001:4860:4860::8844", "localhost" ] },\n  "routing": {\n    "domainStrategy": "IPOnDemand",\n    "rules": [\n      { "type": "field", "ip": [ "::/0" ], "outboundTag": "direct-v6" },\n      { "type": "field", "ip": [ "0.0.0.0/0" ], "outboundTag": "warp-v4" }\n    ]\n  },\n  "inbounds": [\n    {\n      "port": 10000,\n      "listen": "0.0.0.0",\n      "protocol": "trojan",\n      "settings": {\n        "clients": [ { "password": "${XRAY_PWD}" } ]\n      },\n      "streamSettings": {\n        "network": "ws",\n        "wsSettings": { "path": "${WS_PATH}" }\n      }\n    }\n  ],\n  "outbounds": [\n    { "tag": "direct-v6", "protocol": "freedom", "settings": { "domainStrategy": "UseIPv6" } },\n    { "tag": "warp-v4", "protocol": "socks", "settings": { "servers": [ { "address": "127.0.0.1", "port": 40000 } ] } }\n  ]\n}\nEOF\n\n# \u542f\u52a8 Xray \u5bb9\u5668\ndocker run -d --name xray \\\n  --restart always \\\n  --network host \\\n  -v /etc/xray:/etc/xray \\\n  teddysun/xray:latest\n\n# 7. \u914d\u7f6e Cloudflare Tunnel (\u5165\u7ad9\u5165\u53e3)\ncloudflared service install ${CF_TOKEN}\n\n# \u4fee\u6b63\u542f\u52a8\u53c2\u6570\uff1a\u5f3a\u5236\u4f7f\u7528 IPv6 \u8fde\u63a5 Cloudflare \u8fb9\u7f18\u8282\u70b9\nsed -i \'s/tunnel run/tunnel --edge-ip-version 6 run/g\' /etc/systemd/system/cloudflared.service\n\nsystemctl daemon-reload\nsystemctl restart cloudflared\nsystemctl enable cloudflared\n\n# 8. \u7cfb\u7edf\u5185\u6838\u4f18\u5316 (\u5f00\u542f Ping \u6743\u9650)\nsysctl -w net.ipv4.ping_group_range="0 2147483647"\n'})}),"\n",(0,l.jsxs)(s.ol,{start:"4",children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Target capacity"}),": \u8bbe\u7f6e\u4e3a ",(0,l.jsx)(s.code,{children:"1"}),"\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Fleet \u7ef4\u62a4\u7b56\u7565"}),": \u786e\u4fdd\u52fe\u9009 ",(0,l.jsx)(s.strong,{children:(0,l.jsx)(s.code,{children:"Maintain target capacity"})}),"\u3002","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.em,{children:"\u4f5c\u7528\uff1a\u5f53 Spot \u5b9e\u4f8b\u88ab\u56de\u6536\u65f6\uff0cAWS \u4f1a\u81ea\u52a8\u542f\u52a8\u65b0\u5b9e\u4f8b\u5e76\u91cd\u65b0\u8fd0\u884c\u4e0a\u8ff0\u811a\u672c\uff0c\u5b9e\u73b0\u81ea\u52a8\u590d\u6d3b\u3002"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\u70b9\u51fb ",(0,l.jsx)(s.strong,{children:"Launch"}),"\u3002"]}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"5-cloudflare-\u540e\u53f0\u914d\u7f6e",children:"5. Cloudflare \u540e\u53f0\u914d\u7f6e"}),"\n",(0,l.jsxs)(s.p,{children:["\u5b9e\u4f8b\u542f\u52a8\u7ea6 2-3 \u5206\u949f\u540e\uff0cCloudflare Tunnel \u72b6\u6001\u5e94\u663e\u793a\u4e3a ",(0,l.jsx)(s.strong,{children:"Healthy"}),"\u3002\u6b64\u65f6\u9700\u8981\u914d\u7f6e\u6d41\u91cf\u5165\u53e3\u3002"]}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["\u56de\u5230 ",(0,l.jsx)(s.a,{href:"https://one.dash.cloudflare.com/",children:"Cloudflare Zero Trust Dashboard"})," > ",(0,l.jsx)(s.strong,{children:"Tunnels"}),"\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:["\u627e\u5230\u4f60\u7684 Tunnel\uff0c\u70b9\u51fb ",(0,l.jsx)(s.strong,{children:"Configure"}),"\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:["\u70b9\u51fb ",(0,l.jsx)(s.strong,{children:"Public Hostname"})," \u6807\u7b7e\u9875\uff0c\u70b9\u51fb ",(0,l.jsx)(s.strong,{children:"Add a public hostname"}),"\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u586b\u5199\u4fe1\u606f"}),"\uff1a","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Subdomain"}),": \u8f93\u5165\u4f60\u60f3\u8981\u7684\u524d\u7f00\uff08\u5982 ",(0,l.jsx)(s.code,{children:"proxy"}),"\uff09\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Domain"}),": \u9009\u62e9\u4f60\u7684\u57df\u540d\uff08\u5982 ",(0,l.jsx)(s.code,{children:"example.com"}),"\uff09\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Service Type"}),": ",(0,l.jsx)(s.strong,{children:(0,l.jsx)(s.code,{children:"HTTP"})})," (\u6ce8\u610f\u4e0d\u662f HTTPS\uff0c\u4e5f\u4e0d\u662f TCP)\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"URL"}),": ",(0,l.jsx)(s.strong,{children:(0,l.jsx)(s.code,{children:"localhost:10000"})})," (\u5bf9\u5e94 User Data \u811a\u672c\u4e2d Xray \u7684\u76d1\u542c\u7aef\u53e3)\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:["\u70b9\u51fb ",(0,l.jsx)(s.strong,{children:"Save hostname"}),"\u3002"]}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"6-\u5ba2\u6237\u7aef\u8fde\u63a5\u914d\u7f6e",children:"6. \u5ba2\u6237\u7aef\u8fde\u63a5\u914d\u7f6e"}),"\n",(0,l.jsx)(s.p,{children:"\u8bf7\u5728 Clash\u3001Shadowrocket \u6216\u5176\u4ed6\u652f\u6301 Trojan-WS \u7684\u5ba2\u6237\u7aef\u4e2d\u6dfb\u52a0\u8282\u70b9\u3002"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u670d\u52a1\u5668 (Address)"}),": ",(0,l.jsx)(s.code,{children:"proxy.example.com"})," (\u4f60\u521a\u624d\u7ed1\u5b9a\u7684\u57df\u540d)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u7aef\u53e3 (Port)"}),": ",(0,l.jsx)(s.code,{children:"443"})]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u5bc6\u7801 (Password)"}),": \u811a\u672c\u4e2d\u8bbe\u7f6e\u7684 ",(0,l.jsx)(s.code,{children:"XRAY_PWD"})]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u4f20\u8f93\u534f\u8bae (Network)"}),": ",(0,l.jsx)(s.code,{children:"ws"})," (WebSocket)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u8def\u5f84 (Path)"}),": \u811a\u672c\u4e2d\u8bbe\u7f6e\u7684 ",(0,l.jsx)(s.code,{children:"WS_PATH"})," (\u4f8b\u5982 ",(0,l.jsx)(s.code,{children:"/trojan-ws"}),")"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"TLS (SSL)"}),": ",(0,l.jsx)(s.strong,{children:"\u5f00\u542f (Enable)"})]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"SNI / Peer Name"}),": ",(0,l.jsx)(s.code,{children:"proxy.example.com"})]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"UDP \u8f6c\u53d1"}),": \u5f00\u542f (\u652f\u6301 QUIC \u8bbf\u95ee)"]}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"7-\u6545\u969c\u6392\u67e5\u4e0e\u7ef4\u62a4",children:"7. \u6545\u969c\u6392\u67e5\u4e0e\u7ef4\u62a4"}),"\n",(0,l.jsxs)(s.p,{children:["\u7531\u4e8e\u673a\u5668\u6ca1\u6709\u516c\u7f51 IP\uff0c\u65e0\u6cd5\u76f4\u63a5 SSH\u3002\u5982\u679c\u9047\u5230\u8fde\u63a5\u95ee\u9898\uff0c\u8bf7\u4f7f\u7528 ",(0,l.jsx)(s.strong,{children:"AWS EC2 Serial Console"})," \u8fdb\u884c\u8c03\u8bd5\u3002"]}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u8fde\u63a5\u63a7\u5236\u53f0"}),"\uff1a","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["AWS EC2 \u5217\u8868 > \u9009\u4e2d\u5b9e\u4f8b > \u70b9\u51fb ",(0,l.jsx)(s.strong,{children:"Connect"})," > \u9009\u62e9 ",(0,l.jsx)(s.strong,{children:"EC2 Serial Console"})," > ",(0,l.jsx)(s.strong,{children:"Connect"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u767b\u5f55"}),"\uff1a","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"\u5728\u9ed1\u8272\u7ec8\u7aef\u754c\u9762\u6309\u56de\u8f66\u3002"}),"\n",(0,l.jsxs)(s.li,{children:["\u8f93\u5165\u7528\u6237\u540d\uff1a",(0,l.jsx)(s.code,{children:"root"}),"\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:["\u8f93\u5165\u5bc6\u7801\uff1a\u811a\u672c\u4e2d\u8bbe\u7f6e\u7684 ",(0,l.jsx)(s.code,{children:"ROOT_PASSWORD"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u5e38\u7528\u6392\u67e5\u547d\u4ee4"}),"\uff1a","\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\u68c0\u67e5 Docker \u5bb9\u5668\u72b6\u6001\uff1a",(0,l.jsx)(s.code,{children:"docker ps"})]}),"\n",(0,l.jsxs)(s.li,{children:["\u67e5\u770b Xray \u65e5\u5fd7\uff1a",(0,l.jsx)(s.code,{children:"docker logs xray"})]}),"\n",(0,l.jsxs)(s.li,{children:["\u67e5\u770b Tunnel \u72b6\u6001\uff1a",(0,l.jsx)(s.code,{children:"systemctl status cloudflared"})]}),"\n",(0,l.jsxs)(s.li,{children:["\u67e5\u770b WARP \u72b6\u6001\uff1a",(0,l.jsx)(s.code,{children:"warp-cli --accept-tos status"})]}),"\n",(0,l.jsxs)(s.li,{children:["\u6d4b\u8bd5 IPv6 \u8fde\u901a\u6027\uff1a",(0,l.jsx)(s.code,{children:"curl -6 https://ifconfig.co"})]}),"\n",(0,l.jsxs)(s.li,{children:["\u6d4b\u8bd5 IPv4 (WARP) \u8fde\u901a\u6027\uff1a",(0,l.jsx)(s.code,{children:"curl -x socks5h://127.0.0.1:40000 -4 https://ifconfig.co"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h2,{id:"8-\u5b89\u5168\u5efa\u8bae",children:"8. \u5b89\u5168\u5efa\u8bae"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u8def\u5f84\u4fdd\u62a4"}),"\uff1a\u4e0d\u8981\u5c06 ",(0,l.jsx)(s.code,{children:"WS_PATH"})," \u8bbe\u4e3a\u6839\u76ee\u5f55 ",(0,l.jsx)(s.code,{children:"/"})," \u6216\u7b80\u5355\u8def\u5f84\uff0c\u5efa\u8bae\u4f7f\u7528\u590d\u6742\u7684\u968f\u673a\u5b57\u7b26\u4e32\uff0c\u9632\u6b62\u88ab\u4e3b\u52a8\u63a2\u6d4b\u3002"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u6d4f\u89c8\u5668\u8bbf\u95ee\u884c\u4e3a"}),"\uff1a\u76f4\u63a5\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee\u4f60\u7684\u57df\u540d\u4f1a\u663e\u793a ",(0,l.jsx)(s.code,{children:"400 Bad Request"}),"\uff0c\u8fd9\u662f\u6b63\u5e38\u73b0\u8c61\uff08\u56e0\u4e3a Xray \u62d2\u7edd\u975e Trojan \u6d41\u91cf\uff09\uff0c\u8bc1\u660e\u670d\u52a1\u5df2\u751f\u6548\u3002"]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:"\u901a\u8fc7\u4ee5\u4e0a\u6b65\u9aa4\uff0c\u4f60\u5df2\u6210\u529f\u90e8\u7f72\u4e86\u4e00\u5957\u5168\u81ea\u52a8\u3001\u4f4e\u6210\u672c\u3001\u9ad8\u53ef\u7528\u7684 AWS \u53cc\u6808\u4ee3\u7406\u7cfb\u7edf\u3002"})]})}function x(n={}){const{wrapper:s}={...(0,i.R)(),...n.components};return s?(0,l.jsx)(s,{...n,children:(0,l.jsx)(h,{...n})}):h(n)}}}]);